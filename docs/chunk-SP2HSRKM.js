import{e as g}from"./chunk-NZ27KKE3.js";import{ba as n,fa as u,k as h,ka as a,p as k,r as l,v as f}from"./chunk-MGW57YGE.js";var U=()=>(r,t,e)=>{let o=e.value;return{configurable:!0,enumerable:!1,get(){return o.bind(this)}}};var w=function(r){return typeof r=="function"},p=function(){function r(){this._subs=[]}return r.prototype.add=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._subs=this._subs.concat(t)},Object.defineProperty(r.prototype,"sink",{set:function(t){this._subs.push(t)},enumerable:!0,configurable:!0}),r.prototype.unsubscribe=function(){this._subs.forEach(function(t){return t&&w(t.unsubscribe)&&t.unsubscribe()}),this._subs=[]},r}();var S=[{id:"1",email:"user1@email.com",password:"user1",crefito:"1234",role:"Owner",name:"User 1",token:"user1_token"},{id:"2",email:"user2@email.com",password:"user2",crefito:"1234",role:"Contributor",name:"User 2",token:"user2_token"},{id:"3",email:"user3@email.com",password:"user3",crefito:"1234",role:"Contributor",name:"User 3",token:"user3_token"},{id:"4",email:"user4@email.com",password:"user4",crefito:"1234",role:"User",name:"User 4",token:"user4_token"}];var y=(()=>{let t=class t{constructor(o){this.http=o,this.USERS=S,this.rootUrl="https://localhost:7263/api"}authenticateUser(o){let i=this.USERS.find(c=>c.email===o.email&&c.password===o.password);return l(i)}registerUser(o){return l({name:"eduardo",email:"eduardo.siqueira",token:"encoded_authentication_token_here"})}renewToken(o){return this.http.post(`${this.rootUrl}/auth`,o)}};t.\u0275fac=function(i){return new(i||t)(a(g))},t.\u0275prov=u({token:t,factory:t.\u0275fac,providedIn:"root"});let r=t;return r})();var d="authorization";function m(){return sessionStorage.getItem(d)}var s=class s{constructor(t){this.userService=t,this.authenticated$=new h(null),this.token$=new h(null),this.subs=new p,this.isAuthenticated&&(this.fetchUserInfo(),this.token$.next(this.decodeToken(m())))}fetchUserInfo(){}register(t){return this.userService.registerUser(t).pipe(f(e=>e.token),n(this.authenticateLocally),n(e=>{this.fetchUserInfo()}))}login(t){return this.userService.authenticateUser(t).pipe(f(e=>e.token),n(this.authenticateLocally),n(e=>{this.fetchUserInfo()}))}authenticateLocally(t){this.storeToken(t)}storeToken(t){sessionStorage.setItem(d,t),this.token$.next(this.decodeToken(t))}decodeToken(t){return t||null}get isAuthenticated(){return!!m()}getRole(t){let e=m();return e?t.includes(e):!1}logout(){sessionStorage.removeItem(d),this.token$.next(null),this.subs.unsubscribe()}ngOnDestroy(){this.subs.unsubscribe()}};s.\u0275fac=function(e){return new(e||s)(a(y))},s.\u0275prov=u({token:s,factory:s.\u0275fac,providedIn:"root"});var b=s;k([U()],b.prototype,"authenticateLocally",null);export{p as a,b};
