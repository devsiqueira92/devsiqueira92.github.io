import{Fb as j,Gb as U,L as d,O as u,P as v,Q as x,R as s,Rb as D,V as I,h as m,m as E,mb as S,n as p,p as l,r as w,s as y}from"./chunk-PDW7X3UQ.js";var k=new x("JWT_OPTIONS"),f=(()=>{class o{constructor(e=null){this.tokenGetter=e&&e.tokenGetter||function(){}}urlBase64Decode(e){let t=e.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:{t+="==";break}case 3:{t+="=";break}default:throw new Error("Illegal base64url string!")}return this.b64DecodeUnicode(t)}b64decode(e){let t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",n="";if(e=String(e).replace(/=+$/,""),e.length%4===1)throw new Error("'atob' failed: The string to be decoded is not correctly encoded.");for(let i=0,h,a,M=0;a=e.charAt(M++);~a&&(h=i%4?h*64+a:a,i++%4)?n+=String.fromCharCode(255&h>>(-2*i&6)):0)a=t.indexOf(a);return n}b64DecodeUnicode(e){return decodeURIComponent(Array.prototype.map.call(this.b64decode(e),t=>"%"+("00"+t.charCodeAt(0).toString(16)).slice(-2)).join(""))}decodeToken(e=this.tokenGetter()){return e instanceof Promise?e.then(t=>this._decodeToken(t)):this._decodeToken(e)}_decodeToken(e){if(!e||e==="")return null;let t=e.split(".");if(t.length!==3)throw new Error("The inspected token doesn't appear to be a JWT. Check to make sure it has three parts and see https://jwt.io for more.");let n=this.urlBase64Decode(t[1]);if(!n)throw new Error("Cannot decode the token.");return JSON.parse(n)}getTokenExpirationDate(e=this.tokenGetter()){return e instanceof Promise?e.then(t=>this._getTokenExpirationDate(t)):this._getTokenExpirationDate(e)}_getTokenExpirationDate(e){let t;if(t=this.decodeToken(e),!t||!t.hasOwnProperty("exp"))return null;let n=new Date(0);return n.setUTCSeconds(t.exp),n}isTokenExpired(e=this.tokenGetter(),t){return e instanceof Promise?e.then(n=>this._isTokenExpired(n,t)):this._isTokenExpired(e,t)}_isTokenExpired(e,t){if(!e||e==="")return!0;let n=this.getTokenExpirationDate(e);return t=t||0,n===null?!1:!(n.valueOf()>new Date().valueOf()+t*1e3)}getAuthScheme(e,t){return typeof e=="function"?e(t):e}}return o.\u0275fac=function(e){return new(e||o)(s(k))},o.\u0275prov=u({token:o,factory:o.\u0275fac}),o})(),_=o=>o instanceof Promise?y(()=>o):p(o),P=(()=>{class o{constructor(e,t,n){this.jwtHelper=t,this.document=n,this.standardPorts=["80","443"],this.tokenGetter=e.tokenGetter,this.headerName=e.headerName||"Authorization",this.authScheme=e.authScheme||e.authScheme===""?e.authScheme:"Bearer ",this.allowedDomains=e.allowedDomains||[],this.disallowedRoutes=e.disallowedRoutes||[],this.throwNoTokenError=e.throwNoTokenError||!1,this.skipWhenExpired=e.skipWhenExpired}isAllowedDomain(e){let t=new URL(e.url,this.document.location.origin);if(t.host===this.document.location.host)return!0;let n=`${t.hostname}${t.port&&!this.standardPorts.includes(t.port)?":"+t.port:""}`;return this.allowedDomains.findIndex(i=>typeof i=="string"?i===n:i instanceof RegExp?i.test(n):!1)>-1}isDisallowedRoute(e){let t=new URL(e.url,this.document.location.origin);return this.disallowedRoutes.findIndex(n=>{if(typeof n=="string"){let i=new URL(n,this.document.location.origin);return i.hostname===t.hostname&&i.pathname===t.pathname}return n instanceof RegExp?n.test(e.url):!1})>-1}handleInterception(e,t,n){let i=this.jwtHelper.getAuthScheme(this.authScheme,t);if(!e&&this.throwNoTokenError)throw new Error("Could not get token from tokenGetter function.");let h=p(!1);return this.skipWhenExpired&&(h=e?_(this.jwtHelper.isTokenExpired(e)):p(!0)),e?h.pipe(l(a=>a&&this.skipWhenExpired?t.clone():t.clone({setHeaders:{[this.headerName]:`${i}${e}`}})),w(a=>n.handle(a))):n.handle(t)}intercept(e,t){if(!this.isAllowedDomain(e)||this.isDisallowedRoute(e))return t.handle(e);let n=this.tokenGetter(e);return _(n).pipe(w(i=>this.handleInterception(i,e,t)))}}return o.\u0275fac=function(e){return new(e||o)(s(k),s(f),s(S))},o.\u0275prov=u({token:o,factory:o.\u0275fac}),o})(),X=(()=>{class o{constructor(e){if(e)throw new Error("JwtModule is already loaded. It should only be imported in your application's main module.")}static forRoot(e){return{ngModule:o,providers:[{provide:U,useClass:P,multi:!0},e.jwtOptionsProvider||{provide:k,useValue:e.config},f]}}}return o.\u0275fac=function(e){return new(e||o)(s(o,12))},o.\u0275mod=I({type:o}),o.\u0275inj=v({}),o})();var N=()=>(o,r,e)=>{let t=e.value;return{configurable:!0,enumerable:!1,get(){return t.bind(this)}}};var $=function(o){return typeof o=="function"},b=function(){function o(){this._subs=[]}return o.prototype.add=function(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];this._subs=this._subs.concat(r)},Object.defineProperty(o.prototype,"sink",{set:function(r){this._subs.push(r)},enumerable:!0,configurable:!0}),o.prototype.unsubscribe=function(){this._subs.forEach(function(r){return r&&$(r.unsubscribe)&&r.unsubscribe()}),this._subs=[]},o}();var R=[{id:"1",email:"user1@email.com",password:"user1",crefito:"1234",role:"Owner",name:"User 1",token:"user1_token"},{id:"2",email:"user2@email.com",password:"user2",crefito:"1234",role:"Contributor",name:"User 2",token:"user2_token"},{id:"3",email:"user3@email.com",password:"user3",crefito:"1234",role:"Contributor",name:"User 3",token:"user3_token"},{id:"4",email:"user4@email.com",password:"user4",crefito:"1234",role:"User",name:"User 4",token:"user4_token"}];var C=(()=>{let r=class r{constructor(t){this.http=t,this.USERS=R,this.rootUrl=D.baseUrl}authenticateUser(t){return this.http.post(`${this.rootUrl}/auth/login`,t)}registerUser(t){return this.http.post(`${this.rootUrl}/auth/register`,t)}renewToken(t){return this.http.post(`${this.rootUrl}/auth`,t)}};r.\u0275fac=function(n){return new(n||r)(s(j))},r.\u0275prov=u({token:r,factory:r.\u0275fac,providedIn:"root"});let o=r;return o})();var g="authorization";function J(){return sessionStorage.getItem(g)}var c=class c{constructor(r,e){this.userService=r,this.jwtHelper=e,this.authenticated$=new m(null),this.token$=new m(null),this.subs=new b,this.isAuthenticated&&(this.fetchUserInfo(),this.token$.next(this.decodeToken(J())))}fetchUserInfo(){}register(r){return this.userService.registerUser(r).pipe(l(e=>e.token),d(this.authenticateLocally),d(e=>{this.fetchUserInfo()}))}login(r){return this.userService.authenticateUser(r).pipe(l(e=>e.token),d(this.authenticateLocally),d(e=>{this.fetchUserInfo()}))}authenticateLocally(r){this.storeToken(r)}storeToken(r){sessionStorage.setItem(g,r),this.token$.next(this.decodeToken(r))}decodeToken(r){return r?this.jwtHelper.decodeToken(r):null}get isAuthenticated(){let r=J();return r?!this.jwtHelper.isTokenExpired(r):!1}logout(){sessionStorage.removeItem(g),this.token$.next(null),this.subs.unsubscribe()}ngOnDestroy(){this.subs.unsubscribe()}};c.\u0275fac=function(e){return new(e||c)(s(C),s(f))},c.\u0275prov=u({token:c,factory:c.\u0275fac,providedIn:"root"});var T=c;E([N()],T.prototype,"authenticateLocally",null);export{b as a,X as b,J as c,T as d};
